<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible"
          content="ie=edge">
    <meta name=
          "apple-mobile-web-app-status-bar"
          content="#07305c">
    <meta name="theme-color" content="#07305c">


    <!-- Manifest File link -->
    <link rel="manifest" href="{{ asset('manifest.webmanifest') }}">
<title>Title</title>
{% block headscripts %}{% endblock %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="{{ asset('css/main.css') }}">
<script src="{{ asset('js/fnc.js') }}"></script>
</head>
<body style="display: none" class="container-fluid vh-100 vw-100">
{% block body %}{% endblock %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('js/sw.js')
            .then(function () {console.log('Enregistrement reussi.')})
            .catch(function (e) {console.error(e)});
    }
</script>
<script src="{{ asset('js/form.js') }}"></script>
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
<script>
/*
    document.querySelector('#add-button').addEventListener('click', async () => {
        // Hide the app provided install promotion
        hideInstallPromotion();
        // Show the install prompt
        deferredPrompt.prompt();
        // Wait for the user to respond to the prompt
        const { outcome } = await deferredPrompt.userChoice;
        // Optionally, send analytics event with outcome of user choice
        console.log(`User response to the install prompt: ${outcome}`);
        // We've used the prompt, and can't use it again, throw it away
        deferredPrompt = null;
    });

*/

    const app = new bootstrap.Modal(document.getElementById('app'), {});
    document.querySelectorAll('[title]').forEach(t => {
        return new bootstrap.Tooltip(t)
    })
    if (window.location.href.split('@')[1]) {
        genLink(window.location.href);
    }

   /* window.addEventListener('load', () => {
        //registerSW();
    });
*/

    // Register the Service Worker
    async function registerSW() {
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {

                for(let registration of registrations) {

                    registration.unregister()

                }}).catch(function(err) {

                console.log('Service Worker registration failed: ', err);

            });
            try {
                await navigator
                    .serviceWorker
                    .register('{{ asset('js/sw.js') }}');
            } catch (e) {
                console.log('SW registration failed');
            }
        }
    }
    const html5QrCode = new Html5Qrcode(
        "qr-video", { formatsToSupport: [ Html5QrcodeSupportedFormats.QR_CODE ] });
</script>
{% block javascripts %}
{% endblock %}
</body>
</html>
